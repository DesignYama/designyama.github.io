function init(){scene=new THREE.Scene,birds=[],boids=[],camera=new THREE.PerspectiveCamera(50,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.set(0,-20,480),camera.lookAt(0,0,0),light=new THREE.DirectionalLight(16777215,1.4),light.position.set(-25,-40,400),scene.add(light),mountain=new THREE.Mesh(new THREE.TetrahedronGeometry(111,0),new THREE.MeshLambertMaterial({color:46210})),mountain.rotation.x=-.78,mountain.rotation.y=0,mountain.rotation.z=.78,scene.add(mountain);for(var i=0;77>i;i++)boid=boids[i]=new Boid,boid.position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),bird=birds[i]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215,opacity:.68,side:THREE.DoubleSide})),bird.phase=Math.floor(62.83*Math.random()),scene.add(bird);renderer=new THREE.CanvasRenderer,renderer.setClearColor(51455),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),document.addEventListener("mousemove",onDocumentMouseMove,!1),window.addEventListener("resize",onWindowResize,!1),onWindowResize()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(i){for(var t=new THREE.Vector3(i.clientX-SCREEN_WIDTH_HALF,-i.clientY+SCREEN_HEIGHT_HALF,0),o=0,e=boids.length;e>o;o++)boid=boids[o],t.z=boid.position.z,boid.repulse(t)}function animate(){requestAnimationFrame(animate),rotate=rotate>359?0:rotate+1,mountain.rotation.x+=-8e-4,mountain.rotation.y+=-.0012,render()}function render(){for(var i=0,t=birds.length;t>i;i++)boid=boids[i],boid.run(boids),bird=birds[i],bird.position.copy(boids[i].position),bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase);document.getElementById("canvas").appendChild(renderer.domElement),renderer.render(scene,camera)}$(function(){$(".js-adjust-window").each(function(){$(this).height(window.innerHeight)})});var Boid=function(){var i,t,o=new THREE.Vector3,e=400,n=500,s=400,a=100,r=4,d=.36,h=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,i=new THREE.Vector3,this.setGoal=function(i){t=i},this.setAvoidWalls=function(i){h=i},this.setWorldSize=function(i,t,o){e=i,n=t,s=o},this.run=function(t){h&&(o.set(-e,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(e,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,-n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,-s),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,s),o=this.avoid(o),o.multiplyScalar(5),i.add(o)),Math.random()>.5&&this.flock(t),this.move()},this.flock=function(o){t&&i.add(this.reach(t,.005)),i.add(this.alignment(o)),i.add(this.cohesion(o)),i.add(this.separation(o))},this.move=function(){this.velocity.add(i);var t=this.velocity.length();t>r&&this.velocity.divideScalar(t/r),this.position.add(this.velocity),i.set(0,0,0)},this.checkBounds=function(){this.position.x>e&&(this.position.x=-e),this.position.x<-e&&(this.position.x=e),this.position.y>n&&(this.position.y=-n),this.position.y<-n&&(this.position.y=n),this.position.z>s&&(this.position.z=-s),this.position.z<-s&&(this.position.z=s)},this.avoid=function(i){var t=new THREE.Vector3;return t.copy(this.position),t.sub(i),t.multiplyScalar(1/this.position.distanceToSquared(i)),t},this.repulse=function(t){var o=this.position.distanceTo(t);if(150>o){var e=new THREE.Vector3;e.subVectors(this.position,t),e.multiplyScalar(.5/o),i.add(e)}},this.reach=function(i,t){var o=new THREE.Vector3;return o.subVectors(i,this.position),o.multiplyScalar(t),o},this.alignment=function(i){for(var t,o=new THREE.Vector3,e=0,n=0,s=i.length;s>n;n++)Math.random()>.6||(t=i[n],distance=t.position.distanceTo(this.position),distance>0&&distance<=a&&(o.add(t.velocity),e++));if(e>0){o.divideScalar(e);var r=o.length();r>d&&o.divideScalar(r/d)}return o},this.cohesion=function(i){for(var t,o,e=new THREE.Vector3,n=new THREE.Vector3,s=0,r=0,h=i.length;h>r;r++)Math.random()>.6||(t=i[r],o=t.position.distanceTo(this.position),o>0&&a>=o&&(e.add(t.position),s++));s>0&&e.divideScalar(s),n.subVectors(e,this.position);var c=n.length();return c>d&&n.divideScalar(c/d),n},this.separation=function(i){for(var t,o,e=new THREE.Vector3,n=new THREE.Vector3,s=0,r=i.length;r>s;s++)Math.random()>.6||(t=i[s],o=t.position.distanceTo(this.position),o>0&&a>=o&&(n.subVectors(this.position,t.position),n.normalize(),n.divideScalar(o),e.add(n)));return e}},SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2,camera,light,scene,renderer,mountain,birds,bird,boid,boids,angle=360,deg,rotate=0;init(),animate();